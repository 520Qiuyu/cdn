# éŸ³ä¹JSONå·¥å…·é›†

## ç®€ä»‹

è¿™æ˜¯ä¸€å¥—ç”¨äºå¤„ç†éŸ³ä¹JSONæ–‡ä»¶çš„å·¥å…·è„šæœ¬ï¼ŒåŒ…å«å¯¹æ¯”å’Œåˆå¹¶åŠŸèƒ½ã€‚

- **å¯¹æ¯”å·¥å…·** (`compareMusicJson.js`): è¯¦ç»†åˆ†æä¸¤ä¸ªæ–‡ä»¶çš„å·®å¼‚
- **åˆå¹¶å·¥å…·** (`mergeMusicJson.js`): æ™ºèƒ½åˆå¹¶å¤šä¸ªæ–‡ä»¶çš„å†…å®¹

## åŠŸèƒ½ç‰¹ç‚¹

- âœ… ç»Ÿè®¡ä¸¤ä¸ªæ–‡ä»¶çš„ä¸“è¾‘æ•°é‡å’Œæ­Œæ›²æ•°é‡
- âœ… åˆ—å‡ºæ¯ä¸ªä¸“è¾‘åŒ…å«çš„æ‰€æœ‰æ­Œæ›²
- âœ… è¯†åˆ«ä»…åœ¨æŸä¸ªæ–‡ä»¶ä¸­å­˜åœ¨çš„ä¸“è¾‘
- âœ… è¯†åˆ«ä»…åœ¨æŸä¸ªæ–‡ä»¶ä¸­å­˜åœ¨çš„æ­Œæ›²ï¼ˆåŸºäºæ­Œå+ä¸“è¾‘åï¼‰
- âœ… å¯¹æ¯”å…±åŒä¸“è¾‘ä¸­çš„æ­Œæ›²æ•°é‡å·®å¼‚
- âœ… ç”Ÿæˆè¯¦ç»†çš„å¯¹æ¯”æŠ¥å‘Š
- âœ… æ”¯æŒé…ç½®æ–‡ä»¶è·¯å¾„
- âœ… å¯å°†ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶æˆ–æ§åˆ¶å°

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰

```bash
node scripts/compareMusicJson.js
```

### æ–¹å¼äºŒï¼šä¿®æ”¹é…ç½®åè¿è¡Œ

1. å¤åˆ¶é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
```bash
cp scripts/config.example.json scripts/config.json
```

2. ç¼–è¾‘ `scripts/config.json`ï¼Œä¿®æ”¹è¦å¯¹æ¯”çš„æ–‡ä»¶è·¯å¾„ï¼š
```json
{
  "file1": "path/to/your/file1.json",
  "file2": "path/to/your/file2.json",
  "outputPath": "./scripts/comparison-report.txt",
  "writeToFile": true,
  "showInConsole": true
}
```

3. åœ¨è„šæœ¬ä¸­åŠ è½½é…ç½®æ–‡ä»¶è¿è¡Œï¼ˆéœ€è¦ä¿®æ”¹è„šæœ¬å¯¼å…¥é…ç½®ï¼‰

### æ–¹å¼ä¸‰ï¼šä½œä¸ºæ¨¡å—ä½¿ç”¨

```javascript
const { compareMusic } = require('./scripts/compareMusicJson.js');

// è‡ªå®šä¹‰é…ç½®
const customConfig = {
  file1: 'path/to/file1.json',
  file2: 'path/to/file2.json',
  outputPath: './my-report.txt',
  writeToFile: true,
  showInConsole: true
};

// æ‰§è¡Œå¯¹æ¯”
const result = compareMusic(customConfig);

// ä½¿ç”¨è¿”å›çš„ç»“æœ
console.log(result.analysis1);
console.log(result.differences);
```

## é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `file1` | string | ç¬¬ä¸€ä¸ªJSONæ–‡ä»¶è·¯å¾„ | - |
| `file2` | string | ç¬¬äºŒä¸ªJSONæ–‡ä»¶è·¯å¾„ | - |
| `outputPath` | string | è¾“å‡ºæŠ¥å‘Šçš„æ–‡ä»¶è·¯å¾„ | `./scripts/comparison-report.txt` |
| `writeToFile` | boolean | æ˜¯å¦å°†ç»“æœå†™å…¥æ–‡ä»¶ | `true` |
| `showInConsole` | boolean | æ˜¯å¦åœ¨æ§åˆ¶å°æ˜¾ç¤ºç»“æœ | `true` |

## JSONæ–‡ä»¶æ ¼å¼è¦æ±‚

è„šæœ¬æ”¯æŒä¸¤ç§JSONæ ¼å¼ï¼š

### æ ¼å¼ä¸€ï¼šç›´æ¥æ•°ç»„
```json
[
  {
    "artist": "æ­Œæ‰‹å",
    "artists": ["æ­Œæ‰‹å"],
    "album": "ä¸“è¾‘å",
    "id": 12345,
    "name": "æ­Œæ›²å",
    "ext": "flac",
    "bitrate": 1700
  }
]
```

### æ ¼å¼äºŒï¼šdataå­—æ®µåŒ…è£…
```json
{
  "data": [
    {
      "artist": "æ­Œæ‰‹å",
      "artists": ["æ­Œæ‰‹å"],
      "album": "ä¸“è¾‘å",
      "id": 12345,
      "name": "æ­Œæ›²å",
      "ext": "flac",
      "bitrate": 1700
    }
  ]
}
```

## å·®å¼‚è¯†åˆ«è§„åˆ™

- **ä¸“è¾‘å·®å¼‚**ï¼šåŸºäºä¸“è¾‘åï¼ˆalbumå­—æ®µï¼‰
- **æ­Œæ›²å·®å¼‚**ï¼šåŸºäº"æ­Œæ›²å + ä¸“è¾‘å"ç»„åˆçš„å”¯ä¸€æ ‡è¯†

åŒä¸€é¦–æ­Œåœ¨ä¸åŒä¸“è¾‘ä¸­ä¼šè¢«è§†ä¸ºä¸åŒçš„æ­Œæ›²ã€‚

## è¾“å‡ºç¤ºä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           éŸ³ä¹JSONæ–‡ä»¶å¯¹æ¯”åˆ†ææŠ¥å‘Š                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š æ€»ä½“ç»Ÿè®¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ–‡ä»¶1: stolenList (28).json
  - ä¸“è¾‘æ€»æ•°: 100ä¸ª
  - æ­Œæ›²æ€»æ•°: 500é¦–

æ–‡ä»¶2: stolenList (29).json
  - ä¸“è¾‘æ€»æ•°: 105ä¸ª
  - æ­Œæ›²æ€»æ•°: 520é¦–

å·®å¼‚ç»Ÿè®¡:
  - ä¸“è¾‘æ•°å·®å¼‚: +5ä¸ª
  - æ­Œæ›²æ•°å·®å¼‚: +20é¦–
...
```

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿JSONæ–‡ä»¶ç¼–ç ä¸ºUTF-8
2. å¤§å‹æ–‡ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿å¤„ç†æ—¶é—´
3. è¾“å‡ºæŠ¥å‘Šä¼šè¦†ç›–å·²å­˜åœ¨çš„åŒåæ–‡ä»¶
4. å»ºè®®å°†é…ç½®æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„è·¯å¾„

---

## äºŒã€åˆå¹¶å·¥å…· (`mergeMusicJson.js`)

### åŠŸèƒ½ç‰¹ç‚¹

- âœ… ä»¥ä¸»æ–‡ä»¶ä¸ºåŸºå‡†è¿›è¡Œæ™ºèƒ½åˆå¹¶
- âœ… è‡ªåŠ¨è¯†åˆ«å‰¯æ–‡ä»¶ä¸­çš„æ–°æ­Œæ›²
- âœ… é¿å…é‡å¤æ·»åŠ å·²å­˜åœ¨çš„æ­Œæ›²
- âœ… æ”¯æŒå¤šç§å”¯ä¸€æ€§åˆ¤æ–­ç­–ç•¥
- âœ… è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶
- âœ… ç”Ÿæˆè¯¦ç»†çš„åˆå¹¶æŠ¥å‘Š
- âœ… æ”¯æŒæ‰¹é‡åˆå¹¶å¤šä¸ªæ–‡ä»¶
- âœ… äº¤äº’å¼åˆå¹¶æ¨¡å¼ï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰

### ä½¿ç”¨æ–¹æ³•

#### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œï¼ˆè‡ªåŠ¨åˆå¹¶ï¼‰

```bash
node scripts/mergeMusicJson.js
```

é»˜è®¤é…ç½®ä¼šï¼š
- ä»¥ `stolenList (28).json` ä¸ºä¸»æ–‡ä»¶
- ä» `stolenList (29).json` æå–æ–°æ­Œæ›²
- ä¿å­˜åˆ° `scripts/merged-result.json`
- è‡ªåŠ¨åˆ›å»ºä¸»æ–‡ä»¶å¤‡ä»½

#### æ–¹å¼äºŒï¼šä¿®æ”¹é…ç½®è¿è¡Œ

ç¼–è¾‘ `scripts/mergeMusicJson.js` ä¸­çš„ `config` å¯¹è±¡ï¼š

```javascript
const config = {
  mainFile: 'path/to/main.json',        // ä¸»æ–‡ä»¶ï¼ˆåŸºå‡†ï¼‰
  secondaryFile: 'path/to/secondary.json', // å‰¯æ–‡ä»¶
  outputFile: './scripts/merged-result.json', // è¾“å‡ºè·¯å¾„
  createBackup: true,                    // æ˜¯å¦åˆ›å»ºå¤‡ä»½
  backupPath: '',                        // å¤‡ä»½è·¯å¾„ï¼ˆç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰
  showPreview: true,                     // æ˜¯å¦æ˜¾ç¤ºé¢„è§ˆ
  mergeStrategy: {
    uniqueBy: 'name+album',              // å”¯ä¸€æ€§åˆ¤æ–­
    keepMainOrder: true,                 // ä¿æŒä¸»æ–‡ä»¶æ’åº
    appendPosition: 'end',               // æ–°æ­Œæ›²ä½ç½®: 'end' æˆ– 'start'
    sortNewByAlbum: true                 // æ–°æ­Œæ›²æ˜¯å¦æŒ‰ä¸“è¾‘æ’åº
  }
};
```

#### æ–¹å¼ä¸‰ï¼šä½œä¸ºæ¨¡å—ä½¿ç”¨

```javascript
const { mergeMusic } = require('./scripts/mergeMusicJson.js');

const customConfig = {
  mainFile: 'artist/3.json',
  secondaryFile: 'artist/5.json',
  outputFile: 'artist/merged.json',
  createBackup: true
};

const result = mergeMusic(customConfig);
console.log(result.message); // "æˆåŠŸåˆå¹¶ X é¦–æ–°æ­Œæ›²"
```

#### æ–¹å¼å››ï¼šäº¤äº’å¼åˆå¹¶ï¼ˆéœ€ç¡®è®¤ï¼‰

```javascript
const { interactiveMerge } = require('./scripts/mergeMusicJson.js');

// ä¼šå…ˆæ˜¾ç¤ºé¢„è§ˆï¼Œè¯¢é—®æ˜¯å¦ç»§ç»­
await interactiveMerge(config);
```

#### æ–¹å¼äº”ï¼šæ‰¹é‡åˆå¹¶

```javascript
const { batchMerge } = require('./scripts/mergeMusicJson.js');

// å°†å¤šä¸ªæ–‡ä»¶åˆå¹¶åˆ°ä¸»æ–‡ä»¶
batchMerge(
  'artist/main.json',
  ['artist/file1.json', 'artist/file2.json', 'artist/file3.json'],
  {
    outputFile: 'artist/merged.json',
    uniqueBy: 'name+album'
  }
);
```

### åˆå¹¶ç­–ç•¥è¯´æ˜

#### uniqueByï¼ˆå”¯ä¸€æ€§åˆ¤æ–­ä¾æ®ï¼‰

- `'name+album'` (æ¨è): åŸºäºæ­Œæ›²å+ä¸“è¾‘ååˆ¤æ–­ï¼ŒåŒä¸€é¦–æ­Œåœ¨ä¸åŒä¸“è¾‘è§†ä¸ºä¸åŒæ­Œæ›²
- `'id'`: åŸºäºæ­Œæ›²IDåˆ¤æ–­
- `'name+artist+album'`: åŸºäºæ­Œæ›²å+æ­Œæ‰‹+ä¸“è¾‘ååˆ¤æ–­ï¼ˆæœ€ä¸¥æ ¼ï¼‰

#### appendPositionï¼ˆæ–°æ­Œæ›²æ·»åŠ ä½ç½®ï¼‰

- `'end'` (é»˜è®¤): æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾
- `'start'`: æ·»åŠ åˆ°æ–‡ä»¶å¼€å¤´

#### sortNewByAlbumï¼ˆæ–°æ­Œæ›²æ’åºï¼‰

- `true` (æ¨è): æ–°å¢çš„æ­Œæ›²æŒ‰ä¸“è¾‘åæ’åºï¼ŒåŒä¸“è¾‘çš„æ­Œæ›²ä¼šèšåœ¨ä¸€èµ·
- `false`: ä¿æŒå‰¯æ–‡ä»¶ä¸­çš„åŸæœ‰é¡ºåº

### è¾“å‡ºæ–‡ä»¶

åˆå¹¶åä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š

1. **åˆå¹¶ç»“æœJSON** (`merged-result.json`): åŒ…å«åˆå¹¶åçš„æ‰€æœ‰æ­Œæ›²
2. **åˆå¹¶æŠ¥å‘Š** (`merged-result.merge-report.txt`): è¯¦ç»†çš„åˆå¹¶è¿‡ç¨‹è®°å½•

### å®‰å…¨æœºåˆ¶

1. **è‡ªåŠ¨å¤‡ä»½**: é»˜è®¤ä¼šå¤‡ä»½ä¸»æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼ä¸º `åŸæ–‡ä»¶å.backup.æ—¶é—´æˆ³.json`
2. **é¢„è§ˆæ¨¡å¼**: é»˜è®¤æ˜¾ç¤ºåˆå¹¶é¢„è§ˆï¼Œäº†è§£å°†è¦æ·»åŠ çš„å†…å®¹
3. **ä¸ä¿®æ”¹åŸæ–‡ä»¶**: é»˜è®¤è¾“å‡ºåˆ°æ–°æ–‡ä»¶ï¼Œä¿æŠ¤åŸå§‹æ•°æ®

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šåˆå¹¶å‘¨æ°ä¼¦çš„ä¸¤ä¸ªä¸“è¾‘åˆ—è¡¨

```javascript
const { mergeMusic } = require('./scripts/mergeMusicJson.js');

mergeMusic({
  mainFile: 'artist/3.json',
  secondaryFile: 'artist/5.json',
  outputFile: 'artist/3-merged.json',
  createBackup: true
});
```

#### ç¤ºä¾‹2ï¼šç›´æ¥è¦†ç›–ä¸»æ–‡ä»¶

```javascript
mergeMusic({
  mainFile: 'artist/3.json',
  secondaryFile: 'artist/5.json',
  outputFile: 'artist/3.json',  // ç›´æ¥è¦†ç›–
  createBackup: true              // ä¼šå…ˆå¤‡ä»½
});
```

#### ç¤ºä¾‹3ï¼šåˆå¹¶å¤šä¸ªæ¥æº

```javascript
const { batchMerge } = require('./scripts/mergeMusicJson.js');

batchMerge(
  'artist/main.json',
  [
    'source1/music.json',
    'source2/music.json',
    'source3/music.json'
  ],
  {
    outputFile: 'artist/complete.json',
    createBackup: true
  }
);
```

### æ³¨æ„äº‹é¡¹

1. åˆå¹¶å‰ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½ï¼Œé™¤éè®¾ç½® `createBackup: false`
2. å¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´æˆ³ï¼Œä¸ä¼šè¦†ç›–å·²æœ‰å¤‡ä»½
3. å¤§æ–‡ä»¶åˆå¹¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
4. å»ºè®®å…ˆä½¿ç”¨å¯¹æ¯”å·¥å…·äº†è§£å·®å¼‚ï¼Œå†è¿›è¡Œåˆå¹¶
5. åˆå¹¶æŠ¥å‘Šä¼šè¯¦ç»†è®°å½•æ‰€æœ‰æ–°å¢çš„æ­Œæ›²ä¿¡æ¯

---

## è®¸å¯

MIT

